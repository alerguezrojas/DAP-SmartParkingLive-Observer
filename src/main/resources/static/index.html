<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartParking Live | Dashboard Profesional</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Toast Container -->
        <div id="toast-container" class="toast-container"></div>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <i class="fa-solid fa-square-parking logo-icon"></i>
                <h2>SmartParking</h2>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li class="active"><a href="#"><i class="fa-solid fa-chart-pie"></i> Dashboard</a></li>
                    <li><a href="#"><i class="fa-solid fa-car"></i> Plazas</a></li>
                    <li><a href="#"><i class="fa-solid fa-clock-rotate-left"></i> Historial</a></li>
                    <li><a href="#"><i class="fa-solid fa-gear"></i> Configuración</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="avatar">A</div>
                    <div class="user-details">
                        <span class="name">Admin User</span>
                        <span class="role">Administrador</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Header -->
            <header class="top-header">
                <div class="header-title">
                    <h1>Dashboard en Tiempo Real</h1>
                    <p>Monitorización y gestión de plazas de aparcamiento</p>
                </div>
                <div class="header-actions">
                    <div class="health-status-pill" id="health-pill">
                        <span class="pill-dot" id="health-dot"></span>
                        <div class="pill-text">
                            <span id="health-status-text">Sin datos</span>
                            <small id="health-updated">Feed: -</small>
                        </div>
                    </div>
                    <div class="connection-status">
                        <span id="connection-indicator" class="indicator disconnected"></span>
                        <span id="connection-text">Desconectado</span>
                    </div>
                    <button class="icon-btn"><i class="fa-regular fa-bell"></i></button>
                </div>
            </header>

            <!-- Dashboard Content -->
            <div class="dashboard-content">
                <!-- Statistics Cards -->
                <section class="stats-grid">
                    <div class="stat-card total">
                        <div class="stat-icon"><i class="fa-solid fa-warehouse"></i></div>
                        <div class="stat-info">
                            <h3>Total Plazas</h3>
                            <p id="total-spots" class="stat-value">0</p>
                        </div>
                    </div>
                    <div class="stat-card free">
                        <div class="stat-icon"><i class="fa-solid fa-check-circle"></i></div>
                        <div class="stat-info">
                            <h3>Disponibles</h3>
                            <p id="free-spots" class="stat-value">0</p>
                        </div>
                    </div>
                    <div class="stat-card occupied">
                        <div class="stat-icon"><i class="fa-solid fa-car-side"></i></div>
                        <div class="stat-info">
                            <h3>Ocupadas</h3>
                            <p id="occupied-spots" class="stat-value">0</p>
                        </div>
                    </div>
                    <div class="stat-card out-of-service">
                        <div class="stat-icon"><i class="fa-solid fa-triangle-exclamation"></i></div>
                        <div class="stat-info">
                            <h3>Mantenimiento</h3>
                            <p id="out-of-service-spots" class="stat-value">0</p>
                        </div>
                    </div>
                    <div class="stat-card health">
                        <div class="stat-icon"><i class="fa-solid fa-heartbeat"></i></div>
                        <div class="stat-info">
                            <h3>Salud sistema</h3>
                            <p id="health-status-card" class="stat-value">-</p>
                            <small id="health-latency">Feed: -</small>
                        </div>
                    </div>
                </section>

                <!-- Charts Section -->
                <section class="charts-section" style="margin-bottom: 2rem;">
                    <div class="card chart-card" style="padding: 1.5rem;">
                        <div class="card-header" style="margin-bottom: 1rem;">
                            <h3><i class="fa-solid fa-chart-pie"></i> Distribución de Plazas</h3>
                        </div>
                        <div class="card-body" style="height: 300px; position: relative;">
                            <canvas id="parkingChart"></canvas>
                        </div>
                    </div>
                </section>

                <div class="content-grid">
                    <!-- Parking Grid Section -->
                    <section class="parking-section card">
                        <div class="card-header">
                            <h2><i class="fa-solid fa-map-location-dot"></i> Mapa de Plazas</h2>
                            <div class="legend">
                                <span class="legend-item"><span class="dot free"></span> Libre</span>
                                <span class="legend-item"><span class="dot occupied"></span> Ocupada</span>
                                <span class="legend-item"><span class="dot maintenance"></span> Mantenimiento</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="parking-grid" class="parking-grid">
                                <!-- Las plazas se generarán dinámicamente -->
                            </div>
                        </div>
                    </section>

                    <!-- Sidebar Right: Controls & Logs -->
                    <div class="sidebar-right">
                        <!-- Pricing -->
                        <section class="pricing-section card">
                            <div class="card-header">
                                <h2><i class="fa-solid fa-ticket"></i> Cotizador de Tarifas</h2>
                            </div>
                            <div class="card-body pricing-body">
                                <div class="control-group">
                                    <label for="pricing-minutes">Minutos de estancia</label>
                                    <input id="pricing-minutes" type="number" min="15" step="15" value="60">
                                </div>
                                <div class="control-row">
                                    <label class="checkbox">
                                        <input id="pricing-subscriber" type="checkbox"> Suscriptor
                                    </label>
                                    <label class="checkbox">
                                        <input id="pricing-ev" type="checkbox"> Vehículo eléctrico
                                    </label>
                                </div>
                                <div class="control-group">
                                    <label for="pricing-start">Hora de inicio</label>
                                    <input id="pricing-start" type="datetime-local">
                                </div>
                                <button class="btn-primary" onclick="calculateQuote()">
                                    <i class="fa-solid fa-calculator"></i> Calcular
                                </button>
                                <div id="pricing-result" class="pricing-result">
                                    <p class="muted">Introduce datos y calcula para ver el desglose.</p>
                                </div>
                            </div>
                        </section>

                        <!-- Controls -->
                        <section class="controls-section card">
                            <div class="card-header">
                                <h2><i class="fa-solid fa-sliders"></i> Panel de Control</h2>
                            </div>
                            <div class="card-body">
                                <div class="control-group">
                                    <label for="spot-selector">Seleccionar Plaza</label>
                                    <div class="select-wrapper">
                                        <select id="spot-selector">
                                            <option value="">-- Seleccione --</option>
                                        </select>
                                        <i class="fa-solid fa-chevron-down"></i>
                                    </div>
                                </div>

                                <div class="control-group">
                                    <label for="status-selector">Nuevo Estado</label>
                                    <div class="select-wrapper">
                                        <select id="status-selector">
                                            <option value="FREE">Libre</option>
                                            <option value="OCCUPIED">Ocupada</option>
                                            <option value="OUT_OF_SERVICE">Mantenimiento</option>
                                        </select>
                                        <i class="fa-solid fa-chevron-down"></i>
                                    </div>
                                </div>

                                <button id="update-btn" onclick="updateSpotStatus()" class="btn-primary">
                                    <i class="fa-solid fa-rotate"></i> Actualizar Estado
                                </button>
                            </div>
                        </section>

                        <!-- Activity Log -->
                        <section class="activity-section card">
                            <div class="card-header">
                                <h2><i class="fa-solid fa-list-ul"></i> Actividad Reciente</h2>
                            </div>
                            <div class="card-body">
                                <div id="activity-log" class="activity-log">
                                    <!-- Los logs se añadirán dinámicamente -->
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script src="app.js"></script>
</body>
</html>

